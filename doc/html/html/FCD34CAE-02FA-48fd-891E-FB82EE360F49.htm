<html xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:MSHelp="http://msdn.microsoft.com/mshelp" xmlns:mshelp="http://msdn.microsoft.com/mshelp" xmlns:ddue="http://ddue.schemas.microsoft.com/authoring/2003/5" xmlns:msxsl="urn:schemas-microsoft-com:xslt"><head><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8" /><META NAME="save" CONTENT="history" /><title>The Incremental Builder</title><link rel="stylesheet" type="text/css" href="../styles/Presentation.css" /><link rel="stylesheet" type="text/css" href="ms-help://Hx/HxRuntime/HxLink.css" /><link rel="stylesheet" type="text/css" href="ms-help://Dx/DxRuntime/DxLink.css" /><script type="text/javascript" src="../scripts/EventUtilities.js"> </script><script type="text/javascript" src="../scripts/SplitScreen.js"> </script><script type="text/javascript" src="../scripts/Dropdown.js"> </script><script type="text/javascript" src="../scripts/script_manifold.js"> </script><script type="text/javascript" src="../scripts/LanguageFilter.js"> </script><script type="text/javascript" src="../scripts/DataStore.js"> </script><script type="text/javascript" src="../scripts/CommonUtilities.js"> </script><script type="text/javascript" src="../scripts/MemberFilter.js"> </script><xml><MSHelp:TOCTitle Title="" /><MSHelp:Keyword Index="A" Term="FCD34CAE-02FA-48fd-891E-FB82EE360F49" /><MSHelp:Attr Name="RevisionNumber" Value="1" /><MSHelp:Attr Name="AssetID" Value="FCD34CAE-02FA-48fd-891E-FB82EE360F49" /><MSHelp:Attr Name="Abstract" Value="The T:org.critterai.nmbuild.IncrementalBuilder implements a flexible build process that can be used at design time to create T:org.critterai.nmgen.PolyMesh and T:org.critterai.nmgen.PolyMeshDetail objects. T:org.critterai.nmbuild.INMGenProcessor 's a ..." /><MSHelp:Attr Name="TopicType" Value="kbArticle" /><MSHelp:Attr Name="Locale" Value="en-us" /></xml><link type="text/css" rel="stylesheet" href="../styles/highlight.css" /><script type="text/javascript" src="../scripts/highlight.js"> </script></head><body><input type="hidden" id="userDataCache" class="userDataStyle" /><input type="hidden" id="hiddenScrollOffset" /><img id="collapseImage" style="display:none; height:0; width:0;" src="../icons/collapse_all.gif" alt="Collapse image" title="Collapse image" /><img id="expandImage" style="display:none; height:0; width:0;" src="../icons/expand_all.gif" alt="Expand Image" title="Expand Image" /><img id="collapseAllImage" style="display:none; height:0; width:0;" src="../icons/collall.gif" alt="CollapseAll image" title="CollapseAll image" /><img id="expandAllImage" style="display:none; height:0; width:0;" src="../icons/expall.gif" alt="ExpandAll image" title="ExpandAll image" /><img id="dropDownImage" style="display:none; height:0; width:0;" src="../icons/twirl_unselected.gif" alt="DropDown image" title="DropDown image" /><img id="dropDownHoverImage" style="display:none; height:0; width:0;" src="../icons/twirl_unselected_hover.gif" alt="DropDownHover image" title="DropDownHover image" /><img id="copyImage" style="display:none; height:0; width:0;" src="../icons/copycode.gif" alt="Copy image" title="Copy image" /><img id="copyHoverImage" style="display:none; height:0; width:0;" src="../icons/copycodeHighlight.gif" alt="CopyHover image" title="CopyHover image" /><img id="checkBoxSelectImage" style="display:none; height:0; width:0;" src="../icons/ch_selected.gif" /><img id="checkBoxUnSelectImage" style="display:none; height:0; width:0;" src="../icons/ch_unselected.gif" /><img id="checkBoxSelectHoverImage" style="display:none; height:0; width:0;" src="../icons/ch_selected_hover.gif" /><img id="checkBoxUnSelectHoverImage" style="display:none; height:0; width:0;" src="../icons/ch_unselected_hover.gif" /><img id="radioSelectImage" style="display:none; height:0; width:0;" src="../icons/r_select.gif" /><img id="radioUnSelectImage" style="display:none; height:0; width:0;" src="../icons/r_unselect.gif" /><img id="radioSelectHoverImage" style="display:none; height:0; width:0;" src="../icons/r_select_hover.gif" /><img id="radioUnSelectHoverImage" style="display:none; height:0; width:0;" src="../icons/r_unselect_hover.gif" /><img id="curvedLeftSelectImage" style="display:none; height:0; width:0;" src="../icons/tab_sel_lft_cnr.gif" /><img id="curvedRightSelectImage" style="display:none; height:0; width:0;" src="../icons/tab_sel_rt_cnr.gif" /><img id="curvedLeftUnSelectImage" style="display:none; height:0; width:0;" src="../icons/tab_unsel_lft_cnr.gif" /><img id="curvedRightUnSelectImage" style="display:none; height:0; width:0;" src="../icons/tab_unsel_rt_cnr.gif" /><img id="gradLeftSelectImage" style="display:none; height:0; width:0;" src="../icons/tab_sel_lft_grad.gif" /><img id="gradRightSelectImage" style="display:none; height:0; width:0;" src="../icons/tab_sel_rt_grad.gif" /><img id="gradLeftUnSelectImage" style="display:none; height:0; width:0;" src="../icons/tab_unsel_lft_grad.gif" /><img id="gradRightUnSelectImage" style="display:none; height:0; width:0;" src="../icons/tab_unsel_rt_grad.gif" /><img id="twirlSelectImage" style="display:none; height:0; width:0;" src="../icons/twirl_selected.gif" /><img id="twirlUnSelectImage" style="display:none; height:0; width:0;" src="../icons/twirl_unselected.gif" /><img id="twirlSelectHoverImage" style="display:none; height:0; width:0;" src="../icons/twirl_selected_hover.gif" /><img id="twirlUnSelectHoverImage" style="display:none; height:0; width:0;" src="../icons/twirl_unselected_hover.gif" /><img id="NSRBottomImage" style="display:none; height:0; width:0;" src="../icons/NSRbottomgrad.gif" /><div id="header"><table id="topTable"><tr id="headerTableRow3"><td><span onclick="ExpandCollapseAll(toggleAllImage)" style="cursor:default;" onkeypress="ExpandCollapseAll_CheckKey(toggleAllImage, event)" tabindex="0"><img ID="toggleAllImage" class="toggleAll" src="../icons/collall.gif" alt="CollapseAll image" title="CollapseAll image" /><label id="collapseAllLabel" for="toggleAllImage" style="display: none;">Collapse All</label><label id="expandAllLabel" for="toggleAllImage" style="display: none;">Expand All</label> </span> | <span id="languageFilterToolTip" style="cursor:default;" onmouseover="languageFilterImage.src=dropDownHoverImage.src;" onmouseout="languageFilterImage.src=dropDownImage.src;" tabindex="0"><img id="languageFilterImage" src="../icons/twirl_unselected.gif" alt="DropDown image" title="DropDown image" /><label id="CSharpLabel" for="languageFilterImage" style="display: none;">Language Filter: C#</label><label id="VisualBasicLabel" for="languageFilterImage" style="display: none;">Language Filter: Visual Basic</label><label id="ManagedCPlusPlusLabel" for="languageFilterImage" style="display: none;">Language Filter: Visual C++</label></span><div id="languageSpan"><div id="CSharp" onclick="changeLanguage(data, 'CSharp', 'cs');"><img id="CSharpImage" onmouseover="mouseOverCheck(CSharpImage,radioSelectImage,radioUnSelectImage,radioSelectHoverImage,radioUnSelectHoverImage)" onmouseout="mouseOutCheck(CSharpImage,radioSelectImage,radioUnSelectImage,radioSelectHoverImage,radioUnSelectHoverImage)" src="../icons/r_unselect.gif" /> C#</div><br /><div id="VisualBasic" onclick="changeLanguage(data, 'VisualBasic', 'vb');"><img id="VisualBasicImage" onmouseover="mouseOverCheck(VisualBasicImage,radioSelectImage,radioUnSelectImage,radioSelectHoverImage,radioUnSelectHoverImage)" onmouseout="mouseOutCheck(VisualBasicImage,radioSelectImage,radioUnSelectImage,radioSelectHoverImage,radioUnSelectHoverImage)" src="../icons/r_unselect.gif" /> Visual Basic</div><br /><div id="ManagedCPlusPlus" onclick="changeLanguage(data, 'ManagedCPlusPlus', 'cpp');"><img id="ManagedCPlusPlusImage" onmouseover="mouseOverCheck(ManagedCPlusPlusImage,radioSelectImage,radioUnSelectImage,radioSelectHoverImage,radioUnSelectHoverImage)" onmouseout="mouseOutCheck(ManagedCPlusPlusImage,radioSelectImage,radioUnSelectImage,radioSelectHoverImage,radioUnSelectHoverImage)" src="../icons/r_unselect.gif" /> Visual C++</div><br /></div> | <a href="#seeAlsoToggle" onclick="OpenSection(seeAlsoToggle)">See Also</a></td></tr><tr id="headerTableRow1"><td align="left"><span id="runningHeaderText">CritterAI Documentation</span></td></tr><tr id="headerTableRow2"><td align="left"><span id="nsrTitle">The Incremental Builder</span></td></tr><tr><td class="nsrBottom" background="../icons/NSRbottomgrad.gif" /></tr></table></div><div id="mainSection"><div id="mainBody"><div id="allHistory" class="saveHistory" onsave="saveAll()" onload="loadAll()" /><span style="color: DarkGray"><p style="color: #dc143c; font-size: 8.5pt; font-weight: bold;">[This is preliminary documentation and is subject to change.]</p></span><div class="introduction"><p>
			The <span sdata="cer" target="T:org.critterai.nmbuild.IncrementalBuilder"><a href="49183141.htm">IncrementalBuilder</a></span> implements a flexible build process that can be used at
			design time to create <span sdata="cer" target="T:org.critterai.nmgen.PolyMesh"><a href="229D6633.htm">PolyMesh</a></span> and <span sdata="cer" target="T:org.critterai.nmgen.PolyMeshDetail"><a href="287D3362.htm">PolyMeshDetail</a></span> objects. <span sdata="cer" target="T:org.critterai.nmbuild.INMGenProcessor"><a href="246E84A2.htm">INMGenProcessor</a></span>'s
			are used to customize the process for almost any need.
			</p><p /><div class="alert"><table><tr><th><img src="../icons/alert_note.gif" title="Note" /> <b>Note:</b></th></tr><tr><td><p>
				This builder is not suitable for use at run-time since it is designed for flexibility
				rather than high performance.
				</p><p>
				There are a lot of configuration settings to deal with during the build process.  See the <span sdata="cer" target="T:org.critterai.nmgen.NMGenParams"><a href="8F938FF5.htm">NMGenParams</a></span>
				documentation for details, including recommendations.
				</p></td></tr></table></div><p> 
			Only one builder is needed if the navigation mesh will contain only a single tile.  Multi-tile meshes require
			one builder for each tile.  (Builders are single use.)
			</p><span id="cbc_1" x-lang="CSharp" codeLanguage="CSharp"><div class="highlight-title"><span class="highlight-copycode" onkeypress="javascript:CopyColorizedCodeCheckKey(this.parentNode, event);" tabindex="0" onmouseover="CopyCodeChangeIcon(this)" onmouseout="CopyCodeChangeIcon(this)" onclick="javascript:CopyColorizedCode(this.parentNode);"><img style="margin-right: 5px;" src="../icons/CopyCode.gif" />Copy</span>C#</div><div class="code"><pre xml:space="preserve"><span class="highlight-comment">// Example: A simple NMGen build.</span>

<span class="highlight-comment">// Where 'mesh' is a TriangleMesh object containing all of the input triangles</span>
<span class="highlight-comment">// and 'config' is a NMGenParams object containing the configuration.</span>

<span class="highlight-comment">// Create an input geometry object.</span>
<span class="highlight-keyword">byte</span>[] areas = NMGen.CreateDefaultAreaBuffer(mesh.triCount);
InputGeometryBuilder gbuilder = InputGeometryBuilder.Create(mesh, areas, <span class="highlight-number">45.5</span>f);
gbuilder.BuildAll();
InputGeometry geom = gbuilder.Result;

<span class="highlight-comment">// Create the incremental builder.</span>
NMGenAssetFlag resultFlags = NMGenAssetFlag.PolyMesh | NMGenAssetFlag.DetailMesh;
IncrementalBuilder builder = IncrementalBuilder.Create(config
        , resultFlags
        , geom
        , ProcessorSet.CreateStandard(ProcessorSet.StandardOptions));

<span class="highlight-comment">// Perform the build and check the result.</span>
builder.BuildAll();

<span class="highlight-keyword">switch</span> (builder.State)
{
        <span class="highlight-keyword">case</span> NMGenState.Aborted:

                <span class="highlight-comment">// Handle the error.</span>
                <span class="highlight-comment">// Check builder messages for details.</span>

        <span class="highlight-keyword">case</span> NMGenState.Complete:

                NMGenAssets result = builder.Result;

                <span class="highlight-comment">// Use the poly and detail mesh data.</span>

        <span class="highlight-keyword">case</span> NMGenState.NoResult:

                <span class="highlight-comment">// No result was produced.  </span>
                <span class="highlight-comment">// Unexpected for single-tile builds.  Not uncommon for multi-tile builds.</span>
                <span class="highlight-comment">// Check builder messages for details.</span>
}</pre></div></span></div><a name="highlevelprocess"> </a><h1 class="heading"><span onclick="ExpandCollapse(sectionToggleID0EEAAA)" style="cursor:default;" onkeypress="ExpandCollapse_CheckKey(sectionToggleID0EEAAA, event)" tabindex="0"><img id="sectionToggleID0EEAAA" class="toggle" name="toggleSwitch" src="../icons/collapse_all.gif" />The Process</span></h1><div id="sectionSectionID0EEAAA" class="section" name="collapseableSection" style=""><p>
				The incremental builder follows the process described by <span sdata="link"><a href="e72bd1ee-04b0-4bbb-a21d-d8d7ecaa11af.htm">The Core Build Process</a></span> topic.
				</p><div class="mediaNear"><img alt="Standard NMGen Build" src="../media/NMGenBuildStandard.png" /></div></div><a name="polyMesh"> </a><h1 class="heading"><span onclick="ExpandCollapse(sectionToggleID0EDAAA)" style="cursor:default;" onkeypress="ExpandCollapse_CheckKey(sectionToggleID0EDAAA, event)" tabindex="0"><img id="sectionToggleID0EDAAA" class="toggle" name="toggleSwitch" src="../icons/collapse_all.gif" />The Polygon Mesh</span></h1><div id="sectionSectionID0EDAAA" class="section" name="collapseableSection" style=""><p>
			The <span sdata="cer" target="T:org.critterai.nmbuild.IncrementalBuilder"><a href="49183141.htm">IncrementalBuilder</a></span>'s main output is a <span sdata="cer" target="T:org.critterai.nmgen.PolyMesh"><a href="229D6633.htm">PolyMesh</a></span> object.
			The polygon mesh is made up of convex polygons with between three and 
			<span sdata="cer" target="F:org.critterai.nmgen.NMGen.MaxAllowedVertsPerPoly"><a href="154C321C.htm">MaxAllowedVertsPerPoly</a></span>
			vertices. Each polygon includes edge link, area, flag data.
			</p><p>
			Polygons may overlap, based on the value of
			<span sdata="cer" target="P:org.critterai.nmgen.NMGenParams.WalkableHeight"><a href="C213821B.htm">WalkableHeight</a></span> used during the build.
			</p><p>
			At the end of the build process all polygons should have at least one flag set.  Usually 
			<span sdata="cer" target="F:org.critterai.nmbuild.NMBuild.DefaultFlag"><a href="525A02E6.htm">DefaultFlag</a></span>.
			</p><p>
			All polygons will have a non-zero area id. (&lt;= <span sdata="cer" target="F:org.critterai.nmgen.NMGen.MaxArea"><a href="124EC9BA.htm">MaxArea</a></span>)
			</p><div class="mediaNear"><img alt="Poly Mesh-Basic" src="../media/PolyMesh-Basic.jpg" /></div></div><a name="detailMesh"> </a><h1 class="heading"><span onclick="ExpandCollapse(sectionToggleID0ECAAA)" style="cursor:default;" onkeypress="ExpandCollapse_CheckKey(sectionToggleID0ECAAA, event)" tabindex="0"><img id="sectionToggleID0ECAAA" class="toggle" name="toggleSwitch" src="../icons/collapse_all.gif" />The Detail Mesh</span></h1><div id="sectionSectionID0ECAAA" class="section" name="collapseableSection" style=""><p>An common optional output of the <span sdata="cer" target="T:org.critterai.nmbuild.IncrementalBuilder"><a href="49183141.htm">IncrementalBuilder</a></span> is a <span sdata="cer" target="T:org.critterai.nmgen.PolyMeshDetail"><a href="287D3362.htm">PolyMeshDetail</a></span> object.</p><p>
			Pathfinding only uses the <span sdata="cer" target="T:org.critterai.nmgen.PolyMesh"><a href="229D6633.htm">PolyMesh</a></span>.  For storage efficiency and speed the polygon mesh doesn't have a lot of height accuracy.  
			But some secondary navigation features require more accurate height data. The detail mesh provides the extra detail.
			</p><p>
			The detail mesh consists of sub-meshes, one for each polygon in the polygon mesh. Each sub-mesh is a 
			triangle mesh that contains all the vertices of its associated polygon, plus additional vertices 
			that provide the extra height detail.
			</p></div><a name="processors"> </a><h1 class="heading"><span onclick="ExpandCollapse(sectionToggleID0EBAAA)" style="cursor:default;" onkeypress="ExpandCollapse_CheckKey(sectionToggleID0EBAAA, event)" tabindex="0"><img id="sectionToggleID0EBAAA" class="toggle" name="toggleSwitch" src="../icons/collapse_all.gif" />The NMGen Processors</span></h1><div id="sectionSectionID0EBAAA" class="section" name="collapseableSection" style=""><p>The NMGen processors provided by the <span sdata="cer" target="T:org.critterai.nmbuild.ProcessorSet"><a href="E67B5D5E.htm">ProcessorSet</a></span> are what give the incremental builder its flexibility and power.
			Without any processors, only a very simple polygon mesh can be created.</p><p>Processors are called during the post-processor step of each stage, in ascending priority. A processor may perform processing 
			during a single stage or multiple stages.
			</p><p>
			Any oject that implements <span sdata="cer" target="T:org.critterai.nmbuild.INMGenProcessor"><a href="246E84A2.htm">INMGenProcessor</a></span> can act as a processor.  The 
			<span sdata="cer" target="T:org.critterai.nmbuild.NMGenProcessor"><a href="2B785CD5.htm">NMGenProcessor</a></span> abstract class provides a good base to start from.
			</p><p>Two common uses for processors include polygon area and flag assignment.</p><h3 class="subHeading">Area Assignment</h3><div class="subsection"><p>
					Area assignment can happen via the <span sdata="cer" target="T:org.critterai.nmbuild.InputGeometry"><a href="AF3844AA.htm">InputGeometry</a></span> object.  But sometimes that isn't convenient or possible.  Another choice 
					is to mark areas into the compact heightfield.  You can use the <span sdata="cer" target="T:org.critterai.nmbuild.AreaBoxMarker"><a href="24D7F85A.htm">AreaBoxMarker</a></span>,
					<span sdata="cer" target="T:org.critterai.nmbuild.AreaCylinderMarker"><a href="8695C7F.htm">AreaCylinderMarker</a></span>, and 
					<span sdata="cer" target="T:org.critterai.nmbuild.AreaConvexMarker"><a href="FD96AF46.htm">AreaConvexMarker</a></span> processors to do this.
					</p><p>
					Because processors are prioritized, area markers can overwrite each other in useful ways.  For example, lets say you have a swamp area with 
					a dry island contained within it.  The swamp area needs to be assigned one area while the island needs to be a assigned a different area.
					If you mark the swamp, the island will be included.  This can't be helped since all markers are convex.  But by marking the island with a higher 
					priority marker, it will be assigned the proper area.
					</p><p>
					Another powerful use of area markers is applying <span sdata="cer" target="F:org.critterai.nmgen.NMGen.NullArea"><a href="C159D881.htm">NullArea</a></span>.
					Sometimes the build process will create polygons in areas you don't like.  For example, there may be clutter on the ground that can technically
					be walked across, but looks bad when it is.  If you mark the area with <span sdata="cer" target="F:org.critterai.nmgen.NMGen.NullArea"><a href="C159D881.htm">NullArea</a></span>,
					then the area will be excluded from the final polygon mesh.
					</p></div><h3 class="subHeading">Polygon Flag Assignment</h3><div class="subsection"><p>
				Polygon flags can be managed entirely in the <span sdata="cer" target="T:org.critterai.nav.Navmesh"><a href="90CC41AC.htm">Navmesh</a></span> object.  But sometimes the flags are best assigned to the <span sdata="cer" target="T:org.critterai.nmgen.PolyMesh"><a href="229D6633.htm">PolyMesh</a></span>
				during the build process.  For example, you may want to assign the 'swim' flag to all 'water' area polygons.
				</p><p>
				The <span sdata="cer" target="T:org.critterai.nmbuild.ApplyPolygonFlags"><a href="E0844A0B.htm">ApplyPolygonFlags</a></span> processor can be used to add flags to all polygons.
				</p><p>
				The <span sdata="cer" target="T:org.critterai.nmbuild.AreaFlagMapper"><a href="DDEA0AEC.htm">AreaFlagMapper</a></span> processor can be used to add flags to polygons based on
				the area id of each polygon.
				</p></div></div><h1 class="heading"><span onclick="ExpandCollapse(seeAlsoToggle)" style="cursor:default;" onkeypress="ExpandCollapse_CheckKey(seeAlsoToggle, event)" tabindex="0"><img id="seeAlsoToggle" class="toggle" name="toggleSwitch" src="../icons/collapse_all.gif" />See Also</span></h1><div id="seeAlsoSection" class="section" name="collapseableSection" style=""><h4 class="subHeading">Concepts</h4><div class="seeAlsoStyle"><span sdata="link"><a href="0b06b934-9f2b-43a3-a96b-6fd9dc8483c7.htm">An Introduction to NMGen</a></span></div><div class="seeAlsoStyle"><span sdata="link"><a href="3D048EB4-7BD1-407a-9442-9DE60C82266E.htm">Compiling the Input</a></span></div><div class="seeAlsoStyle"><span sdata="link"><a href="ad1c623a-56b7-4aa6-921e-f2d67b39622a.htm">Creating the Navigation Mesh</a></span></div><div class="seeAlsoStyle"><span sdata="link"><a href="e76dda55-5f91-4c2a-bf8d-fa34de59e82b.htm">Building Multi-Tile Meshes</a></span></div><div class="seeAlsoStyle"><span sdata="link"><a href="6fb3041b-e9be-4f03-868b-dcac944df19b.htm">Introduction to Heightfields</a></span></div><div class="seeAlsoStyle"><span sdata="link"><a href="e72bd1ee-04b0-4bbb-a21d-d8d7ecaa11af.htm">The Core Build Process</a></span></div><h4 class="subHeading">Reference</h4><div class="seeAlsoStyle"><span sdata="cer" target="T:org.critterai.nmbuild.IncrementalBuilder"><a href="49183141.htm">IncrementalBuilder</a></span></div><div class="seeAlsoStyle"><span sdata="cer" target="T:org.critterai.nmbuild.NMGenAssets"><a href="448E9366.htm">NMGenAssets</a></span></div><div class="seeAlsoStyle"><span sdata="cer" target="T:org.critterai.nmgen.NMGenParams"><a href="8F938FF5.htm">NMGenParams</a></span></div></div><div id="footer"><div class="footerLine"><img width="100%" height="3px" src="../icons/footer.gif" alt="Footer image" title="Footer image" /></div><a href="http://www.critterai.org/" target="_parent">Project Home</a> | <a href="http://code.google.com/p/critterai/" target="_parent">Source Code</a> | <a href="http://www.critterai.org/cailic" target="_parent">License</a><p />Copyright (c) 2010-2012 Stephen A. Pratt</div></div></div></body></html>