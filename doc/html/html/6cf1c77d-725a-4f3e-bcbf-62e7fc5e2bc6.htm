<html xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:MSHelp="http://msdn.microsoft.com/mshelp" xmlns:mshelp="http://msdn.microsoft.com/mshelp" xmlns:ddue="http://ddue.schemas.microsoft.com/authoring/2003/5" xmlns:msxsl="urn:schemas-microsoft-com:xslt"><head><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8" /><META NAME="save" CONTENT="history" /><title>The Navigation Mesh</title><link rel="stylesheet" type="text/css" href="../styles/Presentation.css" /><link rel="stylesheet" type="text/css" href="ms-help://Hx/HxRuntime/HxLink.css" /><link rel="stylesheet" type="text/css" href="ms-help://Dx/DxRuntime/DxLink.css" /><script type="text/javascript" src="../scripts/EventUtilities.js"> </script><script type="text/javascript" src="../scripts/SplitScreen.js"> </script><script type="text/javascript" src="../scripts/Dropdown.js"> </script><script type="text/javascript" src="../scripts/script_manifold.js"> </script><script type="text/javascript" src="../scripts/LanguageFilter.js"> </script><script type="text/javascript" src="../scripts/DataStore.js"> </script><script type="text/javascript" src="../scripts/CommonUtilities.js"> </script><script type="text/javascript" src="../scripts/MemberFilter.js"> </script><xml><MSHelp:TOCTitle Title="The Navigation Mesh" /><MSHelp:Keyword Index="A" Term="6cf1c77d-725a-4f3e-bcbf-62e7fc5e2bc6" /><MSHelp:Attr Name="RevisionNumber" Value="1" /><MSHelp:Attr Name="AssetID" Value="6cf1c77d-725a-4f3e-bcbf-62e7fc5e2bc6" /><MSHelp:Attr Name="Abstract" Value="The navigation mesh is the primary data model for the navigation system. The only user component that deals directly with the mesh on a regular basis is the component that is responsible for creating the mesh and managing its state. Normal navigation ..." /><MSHelp:Attr Name="TopicType" Value="kbArticle" /><MSHelp:Attr Name="Locale" Value="en-us" /></xml></head><body><input type="hidden" id="userDataCache" class="userDataStyle" /><input type="hidden" id="hiddenScrollOffset" /><img id="collapseImage" style="display:none; height:0; width:0;" src="../icons/collapse_all.gif" alt="Collapse image" title="Collapse image" /><img id="expandImage" style="display:none; height:0; width:0;" src="../icons/expand_all.gif" alt="Expand Image" title="Expand Image" /><img id="collapseAllImage" style="display:none; height:0; width:0;" src="../icons/collall.gif" alt="CollapseAll image" title="CollapseAll image" /><img id="expandAllImage" style="display:none; height:0; width:0;" src="../icons/expall.gif" alt="ExpandAll image" title="ExpandAll image" /><img id="dropDownImage" style="display:none; height:0; width:0;" src="../icons/twirl_unselected.gif" alt="DropDown image" title="DropDown image" /><img id="dropDownHoverImage" style="display:none; height:0; width:0;" src="../icons/twirl_unselected_hover.gif" alt="DropDownHover image" title="DropDownHover image" /><img id="copyImage" style="display:none; height:0; width:0;" src="../icons/copycode.gif" alt="Copy image" title="Copy image" /><img id="copyHoverImage" style="display:none; height:0; width:0;" src="../icons/copycodeHighlight.gif" alt="CopyHover image" title="CopyHover image" /><img id="checkBoxSelectImage" style="display:none; height:0; width:0;" src="../icons/ch_selected.gif" /><img id="checkBoxUnSelectImage" style="display:none; height:0; width:0;" src="../icons/ch_unselected.gif" /><img id="checkBoxSelectHoverImage" style="display:none; height:0; width:0;" src="../icons/ch_selected_hover.gif" /><img id="checkBoxUnSelectHoverImage" style="display:none; height:0; width:0;" src="../icons/ch_unselected_hover.gif" /><img id="radioSelectImage" style="display:none; height:0; width:0;" src="../icons/r_select.gif" /><img id="radioUnSelectImage" style="display:none; height:0; width:0;" src="../icons/r_unselect.gif" /><img id="radioSelectHoverImage" style="display:none; height:0; width:0;" src="../icons/r_select_hover.gif" /><img id="radioUnSelectHoverImage" style="display:none; height:0; width:0;" src="../icons/r_unselect_hover.gif" /><img id="curvedLeftSelectImage" style="display:none; height:0; width:0;" src="../icons/tab_sel_lft_cnr.gif" /><img id="curvedRightSelectImage" style="display:none; height:0; width:0;" src="../icons/tab_sel_rt_cnr.gif" /><img id="curvedLeftUnSelectImage" style="display:none; height:0; width:0;" src="../icons/tab_unsel_lft_cnr.gif" /><img id="curvedRightUnSelectImage" style="display:none; height:0; width:0;" src="../icons/tab_unsel_rt_cnr.gif" /><img id="gradLeftSelectImage" style="display:none; height:0; width:0;" src="../icons/tab_sel_lft_grad.gif" /><img id="gradRightSelectImage" style="display:none; height:0; width:0;" src="../icons/tab_sel_rt_grad.gif" /><img id="gradLeftUnSelectImage" style="display:none; height:0; width:0;" src="../icons/tab_unsel_lft_grad.gif" /><img id="gradRightUnSelectImage" style="display:none; height:0; width:0;" src="../icons/tab_unsel_rt_grad.gif" /><img id="twirlSelectImage" style="display:none; height:0; width:0;" src="../icons/twirl_selected.gif" /><img id="twirlUnSelectImage" style="display:none; height:0; width:0;" src="../icons/twirl_unselected.gif" /><img id="twirlSelectHoverImage" style="display:none; height:0; width:0;" src="../icons/twirl_selected_hover.gif" /><img id="twirlUnSelectHoverImage" style="display:none; height:0; width:0;" src="../icons/twirl_unselected_hover.gif" /><img id="NSRBottomImage" style="display:none; height:0; width:0;" src="../icons/NSRbottomgrad.gif" /><div id="header"><table id="topTable"><tr id="headerTableRow3"><td><span onclick="ExpandCollapseAll(toggleAllImage)" style="cursor:default;" onkeypress="ExpandCollapseAll_CheckKey(toggleAllImage, event)" tabindex="0"><img ID="toggleAllImage" class="toggleAll" src="../icons/collall.gif" alt="CollapseAll image" title="CollapseAll image" /><label id="collapseAllLabel" for="toggleAllImage" style="display: none;">Collapse All</label><label id="expandAllLabel" for="toggleAllImage" style="display: none;">Expand All</label> </span> | <span id="languageFilterToolTip" style="cursor:default;" onmouseover="languageFilterImage.src=dropDownHoverImage.src;" onmouseout="languageFilterImage.src=dropDownImage.src;" tabindex="0"><img id="languageFilterImage" src="../icons/twirl_unselected.gif" alt="DropDown image" title="DropDown image" /><label id="CSharpLabel" for="languageFilterImage" style="display: none;">Language Filter: C#</label><label id="VisualBasicLabel" for="languageFilterImage" style="display: none;">Language Filter: Visual Basic</label><label id="ManagedCPlusPlusLabel" for="languageFilterImage" style="display: none;">Language Filter: Visual C++</label></span><div id="languageSpan"><div id="CSharp" onclick="changeLanguage(data, 'CSharp', 'cs');"><img id="CSharpImage" onmouseover="mouseOverCheck(CSharpImage,radioSelectImage,radioUnSelectImage,radioSelectHoverImage,radioUnSelectHoverImage)" onmouseout="mouseOutCheck(CSharpImage,radioSelectImage,radioUnSelectImage,radioSelectHoverImage,radioUnSelectHoverImage)" src="../icons/r_unselect.gif" /> C#</div><br /><div id="VisualBasic" onclick="changeLanguage(data, 'VisualBasic', 'vb');"><img id="VisualBasicImage" onmouseover="mouseOverCheck(VisualBasicImage,radioSelectImage,radioUnSelectImage,radioSelectHoverImage,radioUnSelectHoverImage)" onmouseout="mouseOutCheck(VisualBasicImage,radioSelectImage,radioUnSelectImage,radioSelectHoverImage,radioUnSelectHoverImage)" src="../icons/r_unselect.gif" /> Visual Basic</div><br /><div id="ManagedCPlusPlus" onclick="changeLanguage(data, 'ManagedCPlusPlus', 'cpp');"><img id="ManagedCPlusPlusImage" onmouseover="mouseOverCheck(ManagedCPlusPlusImage,radioSelectImage,radioUnSelectImage,radioSelectHoverImage,radioUnSelectHoverImage)" onmouseout="mouseOutCheck(ManagedCPlusPlusImage,radioSelectImage,radioUnSelectImage,radioSelectHoverImage,radioUnSelectHoverImage)" src="../icons/r_unselect.gif" /> Visual C++</div><br /></div> | <a href="#seeAlsoToggle" onclick="OpenSection(seeAlsoToggle)">See Also</a></td></tr><tr id="headerTableRow1"><td align="left"><span id="runningHeaderText">CritterAI Documentation</span></td></tr><tr id="headerTableRow2"><td align="left"><span id="nsrTitle">The Navigation Mesh</span></td></tr><tr><td class="nsrBottom" background="../icons/NSRbottomgrad.gif" /></tr></table></div><div id="mainSection"><div id="mainBody"><div id="allHistory" class="saveHistory" onsave="saveAll()" onload="loadAll()" /><span style="color: DarkGray"><p style="color: #dc143c; font-size: 8.5pt; font-weight: bold;">[This is preliminary documentation and is subject to change.]</p></span><div class="introduction"><p>
		The navigation mesh is the primary data model for the navigation system.  The only user 
		component that deals directly with the mesh on a regular basis is the component that is 
		responsible for creating the mesh and managing its state.  Normal navigation clients, 
	  the one's needing to perform  pathfinding and such, rarely if ever interact directly with the 
		navigation mesh.
		</p><p>Core Class: <span sdata="cer" target="T:org.critterai.nav.Navmesh"><a href="90CC41AC.htm">Navmesh</a></span></p></div><a name="navmeshstructure"> </a><h1 class="heading"><span onclick="ExpandCollapse(sectionToggleID0EDAAA)" style="cursor:default;" onkeypress="ExpandCollapse_CheckKey(sectionToggleID0EDAAA, event)" tabindex="0"><img id="sectionToggleID0EDAAA" class="toggle" name="toggleSwitch" src="../icons/collapse_all.gif" />The Data Model</span></h1><div id="sectionSectionID0EDAAA" class="section" name="collapseableSection" style=""><a name="tiles"> </a><h3 class="subHeading">Tiles</h3><div class="subsection"><p>
				At the core of the navigation mesh is the tile. Tiles hold the vast majority of structural
				and state information.  In fact, the <span sdata="cer" target="T:org.critterai.nav.Navmesh"><a href="90CC41AC.htm">Navmesh</a></span> class is little more than a tile manager.
				It may consist of a single tile, or many tiles laid out in a grid that can be swapped in and out
				at runtime.
				</p><p>
				The tile based structure of the navigation mesh adds a lot of flexibility.  As mentioned,
				tiles can be swapped in and out at runtime.  This means that the mesh can represent a large
				area, but not all tiles have to be loaded and active, reducing the mesh's memory footprint.  This also allows 
				for a situation where individual tiles can be rebuilt without the need to rebuild the entire mesh.
				</p></div><a name="tilestruture"> </a><h3 class="subHeading">Structural Elements</h3><div class="subsection"><p>
				The tile's structural data is what defines the navigation graph used for pathfinding.  It consists
				of two types of elements: Polygons and off-mesh connections.
				</p><p>
				The core of the structure is a mesh of convex polygons with between three and 
				<span sdata="cer" target="F:org.critterai.nmgen.NMGen.MaxAllowedVertsPerPoly"><a href="154C321C.htm">MaxAllowedVertsPerPoly</a></span> vertices. This 
				mesh is in the same format as NMGen's <span sdata="cer" target="T:org.critterai.nmgen.PolyMesh"><a href="229D6633.htm">PolyMesh</a></span> structure, and usually represents an abstraction
				of a scene's static geometry.
				</p><p>
				Off-mesh connections are optional.  They consist of two connected endpoints, at least one of which resides within a 
				polygon in the polygon mesh.  Off-mesh connections are added to the navigation graph as a single edge and
				represent special travel routes not defined by scene geometry.  Think: The route an agent travels if it jumps 
				over a railing that normally blocks movement.
				</p></div><a name="tilestate"> </a><h3 class="subHeading">State Data</h3><div class="subsection"><p>
				Tiles also contain state data.  This data is associated with individual polygons and off-mesh connections.  State
				data includes area and flags.
				</p><p>
				Areas are used to associate traversal cost to structural elements.  This effects pathfinding.  For example,
				the area representing swampland can have a higher cost than the area representing smooth surfaces such as meadowland.
				</p><p>
				Flags can be used to control when a structural element is traversable.  For example, a
				flag can be set on the polygon below a door to indicate that it is closed and locked.  Or a flag can indicate
				that only agents of a particular type are allowed to traverse the element.
				</p><p>
				It is important to note that areas and flags have no meaning within the navigation mesh
				itself.  The interpretation of the values is dependant on the <span sdata="cer" target="T:org.critterai.nav.NavmeshQueryFilter"><a href="1A24BDAA.htm">NavmeshQueryFilter</a></span>
				used by each navigation client.  For example: One filter may define a cost of 10 for area id 5, while another may define 
				a cost of 2 for the same area. One flag may be set when a door is closed with one filter checking for the flag during 
				pathfinding, while another filter, used by a ghost, ignores the flag completely.
				</p></div><a name="structvsstate"> </a><h3 class="subHeading">Structure Versus State</h3><div class="subsection"><p>Why is it important to know the difference between structural elements and state data?</p><p>
				The first reason is that it is possible to save and load state separately from structure.  One common use case is to 
				have a serialized version of the full navigation mesh that represents its default state.  Then serialized versions of various
				states, such as the last runtime state, are used to overwrite the default state as needed.
				</p><p>
				The main limitation is that a state is only valid for a particular structure.  So you can't, for example, save the state, 
				change the tile structure, then load the original state into the new structure.
				</p><p>The second reason for understanding the difference between structure and state has to to with tile and polygon references...</p></div><a name="referenceids"> </a><h3 class="subHeading">Tile and Polygon References</h3><div class="subsection"><p>
				The last bit of information needed to understand the navigation mesh is the concept of tile and polygon references.  These
				values are one of the few data types that are defined by the navigation mesh rather than the tiles within the mesh.  It is important to
				understand what references are because they are used by various classes to automatically invalidate pathfinding data if the 
				structure of a navigation mesh changes.
				</p><p>
				Essentially, tile and polygon references are unsigned integer 'handles' to structural elements within a navigation mesh. Tile references
				are rarely used by navigation clients, while polygon references are all over the place.  Polygon references are unique for the navigation mesh, 
				so they are useful for easily identifying a polygon without needing to know which tile it belongs to. 
				Despite the name, polygon references can refer to a either a polygon or an off-mesh connection.
				</p><p>
				References can become invalid.  If they are used after they are invalidated, then methods will return a failure status.  
				Polygon references are based on the tile reference.  So they will be invalidated whenever their associated tile reference is invalidated.
				</p><p>
				Structural changes govern the life of a reference.  Changing the configuration of a navigation mesh or the internal structure of a tile 
				will invalidate all associated references.
				</p><p>
				References are preserved during tile state changes such as changes flags and areas.  They are also preserved during normal 
				runtime loading and unloading of tiles, and during normal serialization/de-serialization of a navigation mesh.
				</p></div></div><a name="creation"> </a><h1 class="heading"><span onclick="ExpandCollapse(sectionToggleID0ECAAA)" style="cursor:default;" onkeypress="ExpandCollapse_CheckKey(sectionToggleID0ECAAA, event)" tabindex="0"><img id="sectionToggleID0ECAAA" class="toggle" name="toggleSwitch" src="../icons/collapse_all.gif" />Creating a Navigation Mesh</span></h1><div id="sectionSectionID0ECAAA" class="section" name="collapseableSection" style=""><p>
			There are various pipelines for creating a navigation mesh.  If you are using <a href="http://unity3d.com/" target="_blank">Unity</a>, the 
			<span sdata="link"><a href="61341701-6cb3-408b-9b1e-d60e3fb817e1.htm">Unity extensions</a></span> make it easier.  Otherwise, 
			the basic steps are as follows:
			</p><p>Generate packed tile data:</p><ol><li>Generate <span sdata="cer" target="T:org.critterai.nmgen.PolyMesh"><a href="229D6633.htm">PolyMesh</a></span> and <span sdata="cer" target="T:org.critterai.nmgen.PolyMeshDetail"><a href="287D3362.htm">PolyMeshDetail</a></span> data using NMGen.</li><li>Optionally create a <span sdata="cer" target="T:org.critterai.nmbuild.ConnectionSet"><a href="5AB06572.htm">ConnectionSet</a></span>. (Off-mesh connections.)</li><li>Load the data into a <span sdata="cer" target="T:org.critterai.nav.NavmeshTileBuildData"><a href="73B93BBC.htm">NavmeshTileBuildData</a></span> object.</li><li>Create a <span sdata="cer" target="T:org.critterai.nav.NavmeshTileData"><a href="809F0D0.htm">NavmeshTileData</a></span> object from the build data.</li></ol><p>
			The tile's structure and default state is now locked into a packed data format that is ready to be loaded into
			a navigation mesh.
			</p><p /><div class="alert"><table><tr><th><img src="../icons/alert_note.gif" title="Note" /> <b>Note:</b></th></tr><tr><td><p>
				Using the <span sdata="cer" target="T:org.critterai.nav.NavmeshTileBuildData"><a href="73B93BBC.htm">NavmeshTileBuildData</a></span> class
				directly can be a bit daunting.  The 
				<span sdata="cer" target="M:org.critterai.nmbuild.NMBuild.GetBuildData(org.critterai.nmgen.BuildContext,System.Int32,System.Int32,org.critterai.nmgen.PolyMeshData,org.critterai.nmgen.PolyMeshDetailData,org.critterai.nmbuild.ConnectionSet,System.Boolean)"><a href="57DEEED8.htm">GetBuildData(BuildContext, Int32, Int32, PolyMeshData, PolyMeshDetailData, ConnectionSet, Boolean)</a></span>
				utility method provides a standard way of creating the build data.
				</p></td></tr></table></div><p>Create a navigation mesh:</p><p>
			Single tile navigation meshes are created using the the single step
			<span sdata="cer" target="M:org.critterai.nav.Navmesh.Create(org.critterai.nav.NavmeshTileBuildData,org.critterai.nav.Navmesh@)"><a href="5E67C573.htm">Create(NavmeshTileBuildData, Navmesh<span class="languageSpecificText"><span class="cpp">%</span></span>)</a></span> method.
			</p><p>
			Multi-tile navigation meshes are created then loaded using multiple methods.  Use the 
			<span sdata="cer" target="M:org.critterai.nav.Navmesh.Create(org.critterai.nav.NavmeshParams,org.critterai.nav.Navmesh@)"><a href="1CADA9D.htm">Create(NavmeshParams, Navmesh<span class="languageSpecificText"><span class="cpp">%</span></span>)</a></span> method to initialize an empty mesh. then add tile data using the
			<span sdata="cer" target="M:org.critterai.nav.Navmesh.AddTile(org.critterai.nav.NavmeshTileData,System.UInt32,System.UInt32@)"><a href="1BD21BE2.htm">AddTile(NavmeshTileData, UInt32, UInt32<span class="languageSpecificText"><span class="cpp">%</span></span>)</a></span> method.
			</p></div><a name="serialization"> </a><h1 class="heading"><span onclick="ExpandCollapse(sectionToggleID0EBAAA)" style="cursor:default;" onkeypress="ExpandCollapse_CheckKey(sectionToggleID0EBAAA, event)" tabindex="0"><img id="sectionToggleID0EBAAA" class="toggle" name="toggleSwitch" src="../icons/collapse_all.gif" />Navigation Mesh Serialization</span></h1><div id="sectionSectionID0EBAAA" class="section" name="collapseableSection" style=""><p>
			The <span sdata="cer" target="T:org.critterai.nav.Navmesh"><a href="90CC41AC.htm">Navmesh</a></span> class supports byte serialization using the 
			<span sdata="cer" target="M:org.critterai.nav.Navmesh.GetSerializedMesh"><a href="8371BDC6.htm">GetSerializedMesh<span class="languageSpecificText"><span class="cs">()</span><span class="cpp">()</span><span class="nu">()</span><span class="fs">()</span></span></a></span> 
			method.  This saves the entire mesh.
			</p><p>
			It is possible to serialize state separately from structure on a tile-by-tile basis.  Get the tile
			from the mesh using the <span sdata="cer" target="M:org.critterai.nav.Navmesh.GetTile(System.Int32)"><a href="59E4BC13.htm">GetTile(Int32)</a></span> method, then use the
			<span sdata="cer" target="M:org.critterai.nav.NavmeshTile.GetState(System.Byte[])"><a href="A9EECA9E.htm">GetState(<span class="languageSpecificText"><span class="cpp">array&lt;</span></span>Byte<span class="languageSpecificText"><span class="cpp">&gt;</span><span class="cs">[]</span><span class="vb">()</span><span class="nu">[]</span><span class="fs">[]</span></span>)</a></span> and
			<span sdata="cer" target="M:org.critterai.nav.NavmeshTile.SetState(System.Byte[])"><a href="A9F91D0A.htm">SetState(<span class="languageSpecificText"><span class="cpp">array&lt;</span></span>Byte<span class="languageSpecificText"><span class="cpp">&gt;</span><span class="cs">[]</span><span class="vb">()</span><span class="nu">[]</span><span class="fs">[]</span></span>)</a></span> methods.
			</p></div><h1 class="heading"><span onclick="ExpandCollapse(seeAlsoToggle)" style="cursor:default;" onkeypress="ExpandCollapse_CheckKey(seeAlsoToggle, event)" tabindex="0"><img id="seeAlsoToggle" class="toggle" name="toggleSwitch" src="../icons/collapse_all.gif" />See Also</span></h1><div id="seeAlsoSection" class="section" name="collapseableSection" style=""><h4 class="subHeading">Concepts</h4><div class="seeAlsoStyle"><span sdata="link"><a href="1b3cfec9-7cd3-444c-b83d-dfc551454822.htm">An Introduction to Navigation</a></span></div><div class="seeAlsoStyle"><span sdata="link"><a href="40b9b3c3-f08f-4fcf-b85f-37efea236d43.htm">The Navigation Mesh Query</a></span></div><div class="seeAlsoStyle"><span sdata="link"><a href="24e74166-c465-4e0b-87eb-818c4f7f3a32.htm">The Path Corridor</a></span></div><div class="seeAlsoStyle"><span sdata="link"><a href="2b87d0be-b6ae-409d-97eb-2a3b37c508ad.htm">The Crowd Manager</a></span></div><h4 class="subHeading">Reference</h4><div class="seeAlsoStyle"><span sdata="cer" target="T:org.critterai.nav.Navmesh"><a href="90CC41AC.htm">Navmesh</a></span></div><div class="seeAlsoStyle"><span sdata="cer" target="T:org.critterai.nav.NavmeshQuery"><a href="7D428A30.htm">NavmeshQuery</a></span></div><div class="seeAlsoStyle"><span sdata="cer" target="T:org.critterai.nav.NavmeshTileBuildData"><a href="73B93BBC.htm">NavmeshTileBuildData</a></span></div><div class="seeAlsoStyle"><span sdata="cer" target="T:org.critterai.nav.NavmeshTileData"><a href="809F0D0.htm">NavmeshTileData</a></span></div><div class="seeAlsoStyle"><span sdata="cer" target="T:org.critterai.nav.NavmeshTile"><a href="BDF02040.htm">NavmeshTile</a></span></div></div><div id="footer"><div class="footerLine"><img width="100%" height="3px" src="../icons/footer.gif" alt="Footer image" title="Footer image" /></div><a href="http://www.critterai.org/" target="_parent">Project Home</a> | <a href="http://code.google.com/p/critterai/" target="_parent">Source Code</a> | <a href="http://www.critterai.org/cailic" target="_parent">License</a><p />Copyright (c) 2010-2012 Stephen A. Pratt</div></div></div></body></html>